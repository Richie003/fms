{%extends 'base.html'%}
{%load static%}
{%load myfilter%}
{%block meta_tags%}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="{{request.user}}">
    <meta name="generator" content="Jekyll v4.1.1">
{%endblock%}
    {%block content%}
            <div class="my-3 p-3 bg-white rounded shadow-sm">
                <div class="border-bottom border-gray pb-2 mb-0 d-flex align-items-center">
                    {%if request.user%}{{user|capfirst}}{%endif%} Folders
                    <span class="primary-bg mx-1 rounded fw-bolder" id="cart" style="border:1px solid; width: 30px; text-align:center; color:#fff;">{{folder_count}}</span>
                </div>


                {%for folder_name in folder_data%}
                <div class="media text-muted pt-3">
                    <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                        <div class="d-flex justify-content-between align-items-center w-100" id="append-folder">
                            <a class="filename text-dark font-bold" href="{%url 'folder_files' folder_name.folder %}"><i class="bi-folder text-warning"></i> {{folder_name.folder}}</a>
                            <div class="">
                                <button class="btn btn-sm btn-light px-2 flex-shrink-0 get_folder" type="button"
                                    data-folder='{{folder_name.folder}}' onclick="removeFolder(`{%url 'delete_folder' folder_name.pk %}`, `{{request.path}}`)">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="20" width="15" viewBox="0 0 448 512">
                                        <path d="M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12
                                        12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432
                                        80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48
                                        48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z" fill="#ff0000"/>
                                    </svg>
                                </button>
                                <button class="btn btn-sm btn-light buttss" id="new_file" onclick="handleClick(this)"
                                        data-val={{folder_name.folder}} type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="20" width="15" viewBox="0 0 448 512">
                                            <path d="M352 240v32c0 6.6-5.4 12-12 12h-88v88c0 6.6-5.4 12-12 12h-32c-6.6 0-12-5.4-12-12v-88h-88c-6.6 0-12-5.4-12-12v-32c0-6.6 5.4-12 12-12h88v-88c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v88h88c6.6 0 12 5.4 12 12zm96-160v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-48 346V86c0-3.3-2.7-6-6-6H54c-3.3 0-6 2.7-6 6v340c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z" fill="#00e7ff"/>
                                        </svg>
                                </button>
                            </div>
                        </div>
                        <span class="d-block">{{folder_name.created|date:'D d M Y'}}</span>
                    </div>
                </div>
                {%endfor%}
                <!-- {%for dt in data2%}
                <p class="text-muted"><a href="{{dt.file.url}}" class="text-decoration-none">{{dt.file}}</a></p>
                {%endfor%} -->
                {%if folder_data > 3%}
                <small class="d-block text-right mt-3">
                    <a href="#" style="color:#17a2b8;">All Files <i class="bi bi-layers"></i></a>
                </small>
                {%endif%}
            </div>
    {%endblock%}
{%block scripts%}
<script src="/static/js/jquery.js"></script>
<script src="/static/js/folder.js"></script>
<script>
    
    function getCookie(name){
        var cookieValue = null;
        if (document.cookie && document.cookie !== ''){
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++){
                var cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')){
                    cookieValue = decodeURIComponent(cookie.substring(
                        name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function removeFolder(folderURL, redirectURL) {
        const csrftoken = getCookie('csrftoken');
        let xmlhttp = new XMLHttpRequest();

        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == XMLHttpRequest.DONE){
                if (xmlhttp.status == 200){
                    window.location.replace(redirectURL);
                }else{
                    alert('there was an error');
                }
            }
        }
        xmlhttp.open("DELETE", folderURL, true);
        xmlhttp.setRequestHeader("X-CSRFToken", csrftoken)
        xmlhttp.send();
    }
</script>
{%endblock%}